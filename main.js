(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{b:()=>P});const t=(e,t)=>{const o=e.querySelector(`.${t.id}-error`);t.classList.remove("form__input_type_error"),o.classList.remove("form__input-error_active"),o.textContent=""},o=e=>{if(!e)return;const{formSelector:o,inputSelector:n,submitButtonSelector:c,inactiveButtonClass:a,inputErrorClass:u,errorClass:l}=e;Array.from(document.querySelectorAll(o)).forEach((e=>{((e,{inputSelector:o,submitButtonSelector:n,inactiveButtonClass:c,inputErrorClass:a,errorClass:u})=>{const l=Array.from(e.querySelectorAll(o)),s=e.querySelector(n);r(l,s,c),l.forEach((o=>{o.addEventListener("input",(()=>{((e,o)=>{o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?t(e,o):((e,t,o)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.add("form__input_type_error"),r.textContent=o,r.classList.add("form__input-error_active")})(e,o,o.validationMessage)})(e,o),r(l,s,c)}))}))})(e,{inputSelector:n,submitButtonSelector:c,inactiveButtonClass:a,inputErrorClass:u,errorClass:l})}))},r=(e,t)=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.disabled=!0,t.classList.add("form__submit_inactive")):(t.disabled=!1,t.classList.remove("form__submit_inactive"))};function n(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",a)}function c(e){e.classList.add("popup_is-opened"),Array.from(document.querySelectorAll(".popup__form")).forEach((e=>{Array.from(e.querySelectorAll(".popup__input")).forEach((o=>{t(e,o)}))})),document.addEventListener("keydown",a)}function a(e){"Escape"===e.key&&n(document.querySelector(".popup_is-opened"))}const u={baseUrl:"https://nomoreparties.co/v1/wff-cohort-12",headers:{authorization:"e5e5de72-de46-4c51-be74-1878519f8c80","Content-Type":"application/json"}},l=e=>e.json();function s(e,t){e.remove(),(e=>{(e=>fetch(`https://nomoreparties.co/v1/wff-cohort-12/cards/${e}`,{method:"DELETE",headers:{authorization:"e5e5de72-de46-4c51-be74-1878519f8c80","Content-Type":"application/json"}}).then(l).catch((e=>{throw console.error("Ошибка при удалении карточки:",e),e})))(e).then((e=>{console.log(e)})).catch((e=>{console.log("Удаление не удалось")}))})(t)}function i(e,t){const o=e.classList.contains("card__like-button_is-active");e.classList.toggle("card__like-button_is-active"),((e,t)=>fetch(`https://nomoreparties.co/v1/wff-cohort-12/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:{authorization:"e5e5de72-de46-4c51-be74-1878519f8c80","Content-Type":"application/json"}}).then(l).catch((e=>{throw console.error("Ошибка при отправке запроса на лайк карточки:",e),e})))(t,o).then((t=>{console.log(t),e.parentElement.querySelector(".card__likes").textContent=t.likes.length})).catch((e=>{}))}function p(e,t,o,r,n,c,a,u){const l=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=l.querySelector(".card__delete-button"),i=l.querySelector(".card__like-button"),p=l.querySelector(".card__likes");return l.querySelector(".card__image").src=t,l.querySelector(".card__title").textContent=e,p.textContent=c&&null!==c&&c.length?c.length:0,s.style.display=u?"block":"none",i.addEventListener("click",(()=>{o(i,a)})),s.addEventListener("click",(()=>r(l,a))),l.querySelector(".card__image").addEventListener("click",n),l}const d=document.querySelector(".profile__add-button"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup__caption"),y=document.querySelector(".places__list"),f=document.querySelector(".popup__image"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_image"),S=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_new-card .popup__form"),b=document.querySelector(".popup__input_type_card-name"),C=document.querySelector(".popup__input_type_url");o({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),_.addEventListener("click",(function(){!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((o=>{o.classList.remove(t.inputErrorClass);const r=e.querySelector(`.${o.id}-error`);r.textContent="",r.classList.remove(t.errorClass)})),r.disabled=!0,r.classList.add(t.inactiveButtonClass)}(document.querySelector(".popup_type_edit .popup__form"),{formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"})})),q.addEventListener("submit",(e=>function(e,t){e.preventDefault();const o=q.querySelector(".popup__button");var r,c;o.textContent="Создание...",(r=b.value,c=C.value,fetch(`${u.baseUrl}/cards`,{method:"POST",headers:u.headers,body:JSON.stringify({name:r,link:c})}).then(l).catch((e=>{throw console.error("Ошибка при добавлении новой карточки:",e),e}))).then((e=>{const o=p(b.value,C.value,i,s,g,[],e._id,!0);t.insertBefore(o,t.firstChild),b.value="",C.value="",n(S)})).catch((e=>{console.error("Ошибка при добавлении новой карточки:",e)})).finally((()=>{o.textContent="Создать"}))}(e,y))),document.addEventListener("click",(function(e){if(e.target===_){const e=document.querySelector(".profile__title"),t=document.querySelector(".profile__description"),o=document.querySelector(".popup__input_type_name"),r=document.querySelector(".popup__input_type_description");o.value=e.textContent,r.value=t.textContent}}));const E=document.querySelector(".popup_type_new-card .popup__close"),L=document.querySelector(".popup_type_edit .popup__close");function g(e){const t=e.target,o=t.parentElement.querySelector(".card__title").textContent;f.src=t.src,f.alt=o,m.textContent=o,c(v)}d.addEventListener("click",(()=>c(S))),_.addEventListener("click",(()=>c(h))),E.addEventListener("click",(()=>n(S))),L.addEventListener("click",(()=>n(h))),document.addEventListener("click",(function(e){e.target.classList.contains("popup")&&n(e.target)})),document.querySelector(".popup_type_image .popup__close").addEventListener("click",(()=>{n(v)})),o(),fetch("https://nomoreparties.co/v1/wff-cohort-12/cards ",{method:"GET",headers:{authorization:"e5e5de72-de46-4c51-be74-1878519f8c80","Content-Type":"application/json"}}).then(l).then((e=>{(e=>{const t=document.querySelector(".places__list");e.forEach((e=>{const{name:o,link:r,likes:n,_id:c}=e,a=p(o,r,i,s,g,n,c,"5c395285254b1d61731ca413"===e.owner._id);t.appendChild(a)}))})(e)})).catch((e=>{console.error("Ошибка при получении данных:",e)}));const k=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_update_avatar"),w=document.forms["update-avatar"],B=w.elements.link,T=document.querySelector(".popup_type_update_avatar .popup__close");k.addEventListener("click",(()=>{k.classList.add("clicked"),B.value="",c(x)})),k.addEventListener("mouseout",(()=>k.classList.remove("clicked"))),T.addEventListener("click",(()=>n(x))),w.addEventListener("submit",(e=>function(e,t){e.preventDefault();const o=w.querySelector(".popup__button");o.textContent="Сохранение...",function(e){return fetch(`${u.baseUrl}/users/me/avatar`,{method:"PATCH",headers:{...u.headers,"Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(l).catch((e=>{throw console.error("Ошибка при обновлении аватара:",e),e}))}(t).then((e=>{k.style.backgroundImage=`url(${e.avatar})`,console.log("Ссылка на новый аватар:",t),n(x)})).catch((e=>console.log("Ошибка при обновлении аватара:",e))).finally((()=>{o.textContent="Сохранить"})),n(x)}(e,B.value)));const A=document.querySelector(".popup_type_edit  .popup__form"),$=document.querySelector(".popup__input_type_name"),j=document.querySelector(".popup__input_type_description"),O=document.querySelector(".popup__input_type_url"),P=e=>{const{name:t,about:o,avatar:r}=e;document.querySelector(".profile__title").textContent=t,document.querySelector(".profile__description").textContent=o,document.querySelector(".profile__image").style["background-image"]=`url("${r}")`};fetch(`${u.baseUrl}/users/me`,{method:"GET",headers:u.headers}).then(l).then((e=>{P(e),console.log(e)})).catch((e=>{console.error("Ошибка при получении данных:",e)})),A.addEventListener("submit",(function(e){e.preventDefault();const t=$.value,o=j.value,r=O.value,c=A.querySelector(".popup__button");var a;c.textContent="Сохранение...",(a={name:t,about:o,avatar:r},fetch(`${u.baseUrl}/users/me`,{method:"PATCH",headers:u.headers,body:JSON.stringify(a)}).then(l).catch((e=>{throw console.error("Ошибка при обновлении профиля:",e),e}))).then((e=>{P(e),console.log(e),n(h)})).catch((e=>{console.error("Ошибка при обновлении профиля:",e)})).finally((()=>{c.textContent="Сохранить"}))}))})();